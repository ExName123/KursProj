<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yandex Maps Example</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=c8d072d2-801f-425e-b553-da8361e0ee32&lang=ru_RU"></script>
    <style>
        #map {
            width: 100%;
            height: 600px;
        }
    </style>
</head>

<body>
    <script>
        ymaps.ready(['polylabel.create']).then(function () {
            var textLayouts = {
                label: '<div>{{properties.hintContent}}</div>',
                hint: ymaps.templateLayoutFactory.createClass('<div>{{properties.hintContent}}</div>')
            };

            var map = new ymaps.Map('map', {
                center: [58, 40],
                zoom: 5,
                controls: []
            }, {
                maxZoom: 18,
                minZoom: 2
            });

            var typeList = new ymaps.control.ListBox({
                data: {
                    content: 'Тип подписи'
                },
                items: [
                    new ymaps.control.ListBoxItem({ data: { content: 'Текст' }, state: { selected: true } }),
                    new ymaps.control.ListBoxItem({ data: { content: 'Изображение' } })
                ]
            });

            var zoomControl = new ymaps.control.ZoomControl({
                options: {
                    size: 'small',
                    float: 'none',
                    position: {
                        bottom: 145,
                        right: 10
                    }
                }
            });

            typeList.get(0).events.add('click', function () {
                typeList.get(1).state.set('selected', false);
                updateLabels('text');
                typeList.collapse();
            });

            typeList.get(1).events.add('click', function () {
                typeList.get(0).state.set('selected', false);
                updateLabels('image');
                typeList.collapse();
            });

            map.controls
                .add(typeList, { floatIndex: 0 })
                .add(zoomControl);

            var objectManager = new ymaps.ObjectManager();

            ymaps.borders.load('RU', {
                lang: 'ru',
                quality: 2
            }).then(function (result) {
                var options = {
                    labelDefaults: 'dark',
                    labelLayout: textLayouts.label,
                    fillColor: 'rgba(27, 125, 190, 0.7)',
                    strokeColor: 'rgba(255, 255, 255, 0.8)',
                    openHintOnHover: false,
                    labelTextSize: { '3_6': 12, '7_18': 14 },
                    cursor: 'grab',
                    labelDotCursor: 'pointer',
                    labelPermissibleInaccuracyOfVisibility: 4
                };

                objectManager.add(result.features.map(function (feature) {
                    feature.id = feature.properties.iso3166;
                    feature.properties.regionName = feature.properties.iso3166;
                    feature.options = options;
                    feature.options.fillColor = getRandomColor(); // Generate random color for each region
                    return feature;
                }));

                map.geoObjects.add(objectManager);

                // Add 5000 random points within the bounds of each region
                addRandomPoints(objectManager, 5000);

                var polylabel = new ymaps.polylabel.create(map, objectManager);

                objectManager.events.add(['labelmouseenter', 'labelmouseleave'], function (event) {
                    var polygon = objectManager.objects.getById(event.get('objectId'));
                    var state = polylabel.getLabelState(polygon);
                    var centerProj = map.options.get('projection').toGlobalPixels(state.get('center'), map.getZoom());

                    if (event.get('type') === 'labelmouseenter' && state.get('currentVisibility') === 'dot') {
                        objectManager.objects.hint.open(polygon.id, centerProj);
                    } else {
                        objectManager.objects.hint.close();
                    }
                });
            });

            function updateLabels(type) {
                var layouts = type === 'text' ? textLayouts : imgLayouts;
                objectManager.objects.options.set({
                    hintContentLayout: layouts.hint
                });
                objectManager.objects.each(function (polygon) {
                    objectManager.objects.setObjectOptions(polygon.id, { labelLayout: layouts.label });
                });
            }

            function getRandomColor() {
                // Generate a random color in hexadecimal format
                return '#' + Math.floor(Math.random() * 16777215).toString(16);
            }

            function addRandomPoints(objectManager, count) {
                objectManager.objects.each(function (polygon) {
                    var bounds = polygon.geometry.coordinates[0]; // Get the bounds of the polygon
                    for (var i = 0; i < count; i++) {
                        var randomPoint = [
                            bounds[0][0] + (bounds[2][0] - bounds[0][0]) * Math.random(),
                            bounds[0][1] + (bounds[2][1] - bounds[0][1]) * Math.random()
                        ];
                        objectManager.add({
                            type: 'Feature',
                            geometry: {
                                type: 'Point',
                                coordinates: randomPoint
                            },
                            properties: {
                                iconContent: '1'
                            }
                        });
                    }
                });
            }
        });
        <div id="map"></div>
    </script>
</body>

</html>